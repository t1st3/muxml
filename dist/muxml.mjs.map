{"version":3,"file":"muxml.mjs.map","sources":["../src/index.js"],"sourcesContent":["\nimport {StringDecoder} from 'string_decoder';\nimport deepAssign from 'deep-assign';\nimport sax from 'sax';\nimport through from 'through2';\n\nconst defaultOpts = {\n\tstrict: true,\n\tstripAttributes: false,\n\tstripCdata: true,\n\tstripComments: true,\n\tstripDoctype: true,\n\tstripInstruction: true,\n\tpretty: true,\n\ttagFilter: null,\n\tnewlines: true,\n\tindentStyle: 'spaces',\n\tindentSpaces: 2,\n\tindentTabs: 1,\n\tsaxOptions: {\n\t\ttrim: true,\n\t\tnormalize: false,\n\t\tlowercase: false,\n\t\txmlns: false,\n\t\tposition: false,\n\t\tstrictEntities: false\n\t}\n};\n\nconst self = {};\nself.opts = {};\nself.tagFilter = null;\nself.mustPrint = false;\nself.level = 0;\nself.nestLevel = 0;\nself.isSelfClosing = false;\n\nlet lastChunk = '';\nconst decoder = new StringDecoder('utf8');\nlet parser;\n\nconst transformStream = function (chunk, enc, cb) {\n\tparser = sax.createStream(self.opts.strict, self.opts.saxOptions);\n\tlastChunk += decoder.write(chunk);\n\tconst me = this;\n\n\tfunction entityQuotes(str) {\n\t\treturn str.replace('\"', '&quot;');\n\t}\n\n\tfunction print(xml) {\n\t\tif (self.mustPrint === true) {\n\t\t\tme.push(eol(indent(xml)));\n\t\t}\n\t}\n\n\tfunction indent(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\tfor (let j = self.level; j > 0; j--) {\n\t\t\t\tif (self.opts.indentStyle === 'spaces') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentSpaces; i++) {\n\t\t\t\t\t\txml = ' ' + xml;\n\t\t\t\t\t}\n\t\t\t\t} else if (self.opts.indentStyle === 'tabs') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentTabs; i++) {\n\t\t\t\t\t\txml = '\\t' + xml;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xml;\n\t}\n\n\tfunction eol(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\txml += '\\n';\n\t\t}\n\t\treturn xml;\n\t}\n\n\tparser.onopentag = function (tag) {\n\t\tif (tag.isSelfClosing) {\n\t\t\tself.isSelfClosing = true;\n\t\t}\n\t\tif (tag.name === self.tagFilter) {\n\t\t\tself.mustPrint = true;\n\t\t\tself.nestLevel += 1;\n\t\t}\n\t\tlet printable = '<' + tag.name;\n\t\tif (self.opts.stripAttributes === false) {\n\t\t\tif (tag.attributes) {\n\t\t\t\tfor (const i in tag.attributes) {\n\t\t\t\t\tif (tag.attributes[i]) {\n\t\t\t\t\t\tprintable += ' ' + i + '=\"';\n\t\t\t\t\t\tprintable += entityQuotes(tag.attributes[i]) + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintable += (self.isSelfClosing) ? '/>' : '>';\n\t\tprint(printable);\n\t\tself.level += self.mustPrint ? 1 : 0;\n\t\tme.emit('opentag', tag);\n\t};\n\n\tparser.onclosetag = function (tag) {\n\t\tself.level -= self.mustPrint ? 1 : 0;\n\t\tif (!self.isSelfClosing) {\n\t\t\tprint('</' + tag + '>');\n\t\t}\n\t\tif (tag === self.tagFilter) {\n\t\t\tself.nestLevel -= 1;\n\t\t\tif (self.nestLevel === 0) {\n\t\t\t\tself.mustPrint = false;\n\t\t\t}\n\t\t}\n\t\tself.isSelfClosing = false;\n\t\tme.emit('closetag', tag);\n\t};\n\n\tparser.onattribute = function (attr) {\n\t\tme.emit('attribute', attr);\n\t};\n\n\tparser.ontext = function (text) {\n\t\tprint(text);\n\t\tme.emit('text', text);\n\t};\n\n\tparser.onopencdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint('<![CDATA[');\n\t\t\tme.emit('opencdata');\n\t\t}\n\t};\n\n\tparser.oncdata = function (text) {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tself.level += 1;\n\t\t\tprint(text);\n\t\t\tself.level -= 1;\n\t\t\tme.emit('cdata', text);\n\t\t}\n\t};\n\n\tparser.onclosecdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint(']]>');\n\t\t\tme.emit('closecdata');\n\t\t}\n\t};\n\n\tparser.oncomment = function (comment) {\n\t\tif (self.opts.stripComments === false) {\n\t\t\tprint('<!-- ' + comment + ' -->');\n\t\t\tme.emit('comment', comment);\n\t\t}\n\t};\n\n\tparser.ondoctype = function (doctype) {\n\t\tif (self.opts.stripDoctype === false) {\n\t\t\tprint('<!DOCTYPE' + doctype + '>');\n\t\t\tme.emit('doctype', doctype);\n\t\t}\n\t};\n\n\tparser.onprocessinginstruction = function (instruction) {\n\t\tif (self.opts.stripInstruction === false) {\n\t\t\tprint('<?' + instruction.name + ' ' + instruction.body + '?>');\n\t\t\tme.emit('instruction', instruction);\n\t\t}\n\t};\n\n\tparser.write(lastChunk);\n\tlastChunk = '';\n\tcb();\n};\n\nconst endStream = function (cb) {\n\tlastChunk += decoder.end();\n\tif (lastChunk.length > 0) {\n\t\tparser.write(lastChunk);\n\t}\n\tcb();\n};\n\nexport default function (opts) {\n\tself.mustPrint = false;\n\tself.tagFilter = (opts && opts.tagFilter) ? opts.tagFilter : null;\n\tif (self.tagFilter === null) {\n\t\tself.mustPrint = true;\n\t}\n\tself.level = 0;\n\tself.nestLevel = 0;\n\tdeepAssign(self.opts, defaultOpts, opts ? opts : {});\n\n\treturn through(transformStream, endStream);\n}\n"],"names":["defaultOpts","self","opts","tagFilter","mustPrint","level","nestLevel","isSelfClosing","lastChunk","decoder","StringDecoder","parser","transformStream","chunk","enc","cb","sax","createStream","strict","saxOptions","write","me","entityQuotes","str","replace","print","xml","push","eol","indent","pretty","j","indentStyle","i","indentSpaces","indentTabs","onopentag","tag","name","printable","stripAttributes","attributes","emit","onclosetag","onattribute","attr","ontext","text","onopencdata","stripCdata","oncdata","onclosecdata","oncomment","comment","stripComments","ondoctype","doctype","stripDoctype","onprocessinginstruction","instruction","stripInstruction","body","endStream","end","length","through"],"mappings":"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"}