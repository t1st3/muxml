{"version":3,"file":"muxml.js.map","sources":["../src/index.js"],"sourcesContent":["\nimport {StringDecoder} from 'string_decoder';\nimport deepAssign from 'deep-assign';\nimport sax from 'sax';\nimport through from 'through2';\n\nconst defaultOpts = {\n\tstrict: true,\n\tstripAttributes: false,\n\tstripCdata: true,\n\tstripComments: true,\n\tstripDoctype: true,\n\tstripInstruction: true,\n\tpretty: true,\n\ttagFilter: null,\n\tnewlines: true,\n\tindentStyle: 'spaces',\n\tindentSpaces: 2,\n\tindentTabs: 1,\n\tsaxOptions: {\n\t\ttrim: true,\n\t\tnormalize: false,\n\t\tlowercase: false,\n\t\txmlns: false,\n\t\tposition: false,\n\t\tstrictEntities: false\n\t}\n};\n\nconst self = {};\nself.opts = {};\nself.tagFilter = null;\nself.mustPrint = false;\nself.level = 0;\nself.nestLevel = 0;\nself.isSelfClosing = false;\n\nlet lastChunk = '';\nconst decoder = new StringDecoder('utf8');\nlet parser;\n\nconst transformStream = function (chunk, enc, cb) {\n\tparser = sax.createStream(self.opts.strict, self.opts.saxOptions);\n\tlastChunk += decoder.write(chunk);\n\tconst me = this;\n\n\tfunction entityQuotes(str) {\n\t\treturn str.replace('\"', '&quot;');\n\t}\n\n\tfunction print(xml) {\n\t\tif (self.mustPrint === true) {\n\t\t\tme.push(eol(indent(xml)));\n\t\t}\n\t}\n\n\tfunction indent(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\tfor (let j = self.level; j > 0; j--) {\n\t\t\t\tif (self.opts.indentStyle === 'spaces') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentSpaces; i++) {\n\t\t\t\t\t\txml = ' ' + xml;\n\t\t\t\t\t}\n\t\t\t\t} else if (self.opts.indentStyle === 'tabs') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentTabs; i++) {\n\t\t\t\t\t\txml = '\\t' + xml;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xml;\n\t}\n\n\tfunction eol(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\txml += '\\n';\n\t\t}\n\t\treturn xml;\n\t}\n\n\tparser.onopentag = function (tag) {\n\t\tif (tag.isSelfClosing) {\n\t\t\tself.isSelfClosing = true;\n\t\t}\n\t\tif (tag.name === self.tagFilter) {\n\t\t\tself.mustPrint = true;\n\t\t\tself.nestLevel += 1;\n\t\t}\n\t\tlet printable = '<' + tag.name;\n\t\tif (self.opts.stripAttributes === false) {\n\t\t\tif (tag.attributes) {\n\t\t\t\tfor (const i in tag.attributes) {\n\t\t\t\t\tif (tag.attributes[i]) {\n\t\t\t\t\t\tprintable += ' ' + i + '=\"';\n\t\t\t\t\t\tprintable += entityQuotes(tag.attributes[i]) + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintable += (self.isSelfClosing) ? '/>' : '>';\n\t\tprint(printable);\n\t\tself.level += self.mustPrint ? 1 : 0;\n\t\tme.emit('opentag', tag);\n\t};\n\n\tparser.onclosetag = function (tag) {\n\t\tself.level -= self.mustPrint ? 1 : 0;\n\t\tif (!self.isSelfClosing) {\n\t\t\tprint('</' + tag + '>');\n\t\t}\n\t\tif (tag === self.tagFilter) {\n\t\t\tself.nestLevel -= 1;\n\t\t\tif (self.nestLevel === 0) {\n\t\t\t\tself.mustPrint = false;\n\t\t\t}\n\t\t}\n\t\tself.isSelfClosing = false;\n\t\tme.emit('closetag', tag);\n\t};\n\n\tparser.onattribute = function (attr) {\n\t\tme.emit('attribute', attr);\n\t};\n\n\tparser.ontext = function (text) {\n\t\tprint(text);\n\t\tme.emit('text', text);\n\t};\n\n\tparser.onopencdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint('<![CDATA[');\n\t\t\tme.emit('opencdata');\n\t\t}\n\t};\n\n\tparser.oncdata = function (text) {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tself.level += 1;\n\t\t\tprint(text);\n\t\t\tself.level -= 1;\n\t\t\tme.emit('cdata', text);\n\t\t}\n\t};\n\n\tparser.onclosecdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint(']]>');\n\t\t\tme.emit('closecdata');\n\t\t}\n\t};\n\n\tparser.oncomment = function (comment) {\n\t\tif (self.opts.stripComments === false) {\n\t\t\tprint('<!-- ' + comment + ' -->');\n\t\t\tme.emit('comment', comment);\n\t\t}\n\t};\n\n\tparser.ondoctype = function (doctype) {\n\t\tif (self.opts.stripDoctype === false) {\n\t\t\tprint('<!DOCTYPE' + doctype + '>');\n\t\t\tme.emit('doctype', doctype);\n\t\t}\n\t};\n\n\tparser.onprocessinginstruction = function (instruction) {\n\t\tif (self.opts.stripInstruction === false) {\n\t\t\tprint('<?' + instruction.name + ' ' + instruction.body + '?>');\n\t\t\tme.emit('instruction', instruction);\n\t\t}\n\t};\n\n\tparser.write(lastChunk);\n\tlastChunk = '';\n\tcb();\n};\n\nconst endStream = function (cb) {\n\tlastChunk += decoder.end();\n\tif (lastChunk.length > 0) {\n\t\tparser.write(lastChunk);\n\t}\n\tcb();\n};\n\nexport default function (opts) {\n\tself.mustPrint = false;\n\tself.tagFilter = (opts && opts.tagFilter) ? opts.tagFilter : null;\n\tif (self.tagFilter === null) {\n\t\tself.mustPrint = true;\n\t}\n\tself.level = 0;\n\tself.nestLevel = 0;\n\tdeepAssign(self.opts, defaultOpts, opts ? opts : {});\n\n\treturn through(transformStream, endStream);\n}\n"],"names":["defaultOpts","strict","stripAttributes","stripCdata","stripComments","stripDoctype","stripInstruction","pretty","tagFilter","newlines","indentStyle","indentSpaces","indentTabs","saxOptions","trim","normalize","lowercase","xmlns","position","strictEntities","self","opts","mustPrint","level","nestLevel","isSelfClosing","lastChunk","decoder","StringDecoder","parser","transformStream","chunk","enc","cb","sax","createStream","write","me","entityQuotes","str","replace","print","xml","push","eol","indent","j","i","onopentag","tag","name","printable","attributes","emit","onclosetag","onattribute","attr","ontext","text","onopencdata","oncdata","onclosecdata","oncomment","comment","ondoctype","doctype","onprocessinginstruction","instruction","body","endStream","end","length","deepAssign","through"],"mappings":"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"}