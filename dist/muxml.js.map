{"version":3,"file":null,"sources":["../src/index.js"],"sourcesContent":["\nimport {StringDecoder} from 'string_decoder';\nimport deepAssign from 'deep-assign';\nimport sax from 'sax';\nimport through from 'through2';\n\nconst defaultOpts = {\n\tstrict: true,\n\tstripAttributes: false,\n\tstripCdata: true,\n\tstripComments: true,\n\tstripDoctype: true,\n\tstripInstruction: true,\n\tpretty: true,\n\ttagFilter: null,\n\tnewlines: true,\n\tindentStyle: 'spaces',\n\tindentSpaces: 2,\n\tindentTabs: 1,\n\tsaxOptions: {\n\t\ttrim: true,\n\t\tnormalize: false,\n\t\tlowercase: false,\n\t\txmlns: false,\n\t\tposition: false,\n\t\tstrictEntities: false\n\t}\n};\n\nlet self = {};\nself.opts = {};\nself.emitEvents = {};\nself.saxOptions = {};\nself.tagFilter = null;\nself.mustPrint = false;\nself.level = 0;\nself.nestLevel = 0;\n\nlet lastChunk = '';\nlet decoder = new StringDecoder('utf8');\nlet parser;\n\nlet transformStream = function (chunk, enc, cb) {\n\tparser = sax.createStream(self.opts.strict, self.opts.saxOptions);\n\tlastChunk += decoder.write(chunk);\n\tlet me = this;\n\n\tfunction entityQuotes(str) {\n\t\treturn str.replace('\"', '&quot;');\n\t}\n\n\tfunction print(xml) {\n\t\tif (self.mustPrint === true) {\n\t\t\tme.push(eol(indent(xml)));\n\t\t}\n\t}\n\n\tfunction indent(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\tfor (let j = self.level; j > 0; j--) {\n\t\t\t\tif (self.opts.indentStyle === 'spaces') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentSpaces; i++) {\n\t\t\t\t\t\txml = ' ' + xml;\n\t\t\t\t\t}\n\t\t\t\t} else if (self.opts.indentStyle === 'tabs') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentTabs; i++) {\n\t\t\t\t\t\txml = '\\t' + xml;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xml;\n\t}\n\n\tfunction eol(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\txml += '\\n';\n\t\t}\n\t\treturn xml;\n\t}\n\n\tparser.onopentag = function (tag) {\n\t\tif (tag.name === self.tagFilter) {\n\t\t\tself.mustPrint = true;\n\t\t\tself.nestLevel += 1;\n\t\t}\n\t\tlet printable = '<' + tag.name;\n\t\tif (self.opts.stripAttributes === false) {\n\t\t\tif (tag.attributes) {\n\t\t\t\tfor (let i in tag.attributes) {\n\t\t\t\t\tif (tag.attributes[i]) {\n\t\t\t\t\t\tprintable += ' ' + i + '=\"';\n\t\t\t\t\t\tprintable += entityQuotes(tag.attributes[i]) + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintable += '>';\n\t\tprint(printable);\n\t\tself.level += self.mustPrint ? 1 : 0;\n\t\tme.emit('openTag', tag);\n\t};\n\n\tparser.onclosetag = function (tag) {\n\t\tself.level -= self.mustPrint ? 1 : 0;\n\t\tprint('</' + tag + '>');\n\t\tif (tag === self.tagFilter) {\n\t\t\tself.nestLevel -= 1;\n\t\t\tif (self.nestLevel === 0) {\n\t\t\t\tself.mustPrint = false;\n\t\t\t}\n\t\t}\n\t\tme.emit('closeTag', tag);\n\t};\n\n\tparser.onattribute = function (attr) {\n\t\tme.emit('attribute', attr);\n\t};\n\n\tparser.ontext = function (text) {\n\t\tprint(text);\n\t\tme.emit('text', text);\n\t};\n\n\tparser.onopencdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint('<![CDATA[');\n\t\t\tme.emit('openCdata');\n\t\t}\n\t};\n\n\tparser.oncdata = function (text) {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tself.level += 1;\n\t\t\tprint(text);\n\t\t\tself.level -= 1;\n\t\t\tme.emit('cdata', text);\n\t\t}\n\t};\n\n\tparser.onclosecdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint(']]>');\n\t\t\tme.emit('closeCdata');\n\t\t}\n\t};\n\n\tparser.oncomment = function (comment) {\n\t\tif (self.opts.stripComments === false) {\n\t\t\tprint('<!-- ' + comment + ' -->');\n\t\t\tme.emit('comment', comment);\n\t\t}\n\t};\n\n\tparser.ondoctype = function (doctype) {\n\t\tif (self.opts.stripDoctype === false) {\n\t\t\tprint('<!DOCTYPE' + doctype + '>');\n\t\t\tme.emit('doctype', doctype);\n\t\t}\n\t};\n\n\tparser.onprocessinginstruction = function (instruction) {\n\t\tif (self.opts.stripInstruction === false) {\n\t\t\tprint('<?' + instruction.name + ' ' + instruction.body + '?>');\n\t\t\tme.emit('instruction', instruction);\n\t\t}\n\t};\n\n\tparser.write(lastChunk);\n\tlastChunk = '';\n\tcb();\n};\n\nlet endStream = function (cb) {\n\tlastChunk += decoder.end();\n\tif (lastChunk.length > 0) {\n\t\tparser.write(lastChunk);\n\t}\n\tcb();\n};\n\nexport default function (opts) {\n\tself.mustPrint = false;\n\tself.tagFilter = (opts && opts.tagFilter) ? opts.tagFilter : null;\n\tif (self.tagFilter === null) {\n\t\tself.mustPrint = true;\n\t}\n\tself.level = 0;\n\tself.nestLevel = 0;\n\tdeepAssign(self.opts, defaultOpts, opts ? opts : {});\n\n\treturn through(transformStream, endStream);\n}\n"],"names":["StringDecoder"],"mappings":"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"}