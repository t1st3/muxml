{"version":3,"file":null,"sources":["../src/index.js"],"sourcesContent":["\nimport {StringDecoder} from 'string_decoder';\nimport deepAssign from 'deep-assign';\nimport sax from 'sax';\nimport through from 'through2';\n\nconst defaultOpts = {\n\tstrict: true,\n\tstripAttributes: false,\n\tstripCdata: true,\n\tstripComments: true,\n\tstripDoctype: true,\n\tstripInstruction: true,\n\tpretty: true,\n\ttagFilter: null,\n\tnewlines: true,\n\tindentStyle: 'spaces',\n\tindentSpaces: 2,\n\tindentTabs: 1,\n\tsaxOptions: {\n\t\ttrim: true,\n\t\tnormalize: false,\n\t\tlowercase: false,\n\t\txmlns: false,\n\t\tposition: false,\n\t\tstrictEntities: false\n\t}\n};\n\nconst self = {};\nself.opts = {};\nself.tagFilter = null;\nself.mustPrint = false;\nself.level = 0;\nself.nestLevel = 0;\nself.isSelfClosing = false;\n\nlet lastChunk = '';\nconst decoder = new StringDecoder('utf8');\nlet parser;\n\nconst transformStream = function (chunk, enc, cb) {\n\tparser = sax.createStream(self.opts.strict, self.opts.saxOptions);\n\tlastChunk += decoder.write(chunk);\n\tconst me = this;\n\n\tfunction entityQuotes(str) {\n\t\treturn str.replace('\"', '&quot;');\n\t}\n\n\tfunction print(xml) {\n\t\tif (self.mustPrint === true) {\n\t\t\tme.push(eol(indent(xml)));\n\t\t}\n\t}\n\n\tfunction indent(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\tfor (let j = self.level; j > 0; j--) {\n\t\t\t\tif (self.opts.indentStyle === 'spaces') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentSpaces; i++) {\n\t\t\t\t\t\txml = ' ' + xml;\n\t\t\t\t\t}\n\t\t\t\t} else if (self.opts.indentStyle === 'tabs') {\n\t\t\t\t\tfor (let i = 0; i < self.opts.indentTabs; i++) {\n\t\t\t\t\t\txml = '\\t' + xml;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xml;\n\t}\n\n\tfunction eol(xml) {\n\t\tif (self.opts.pretty === true) {\n\t\t\txml += '\\n';\n\t\t}\n\t\treturn xml;\n\t}\n\n\tparser.onopentag = function (tag) {\n\t\tif (tag.isSelfClosing) {\n\t\t\tself.isSelfClosing = true;\n\t\t}\n\t\tif (tag.name === self.tagFilter) {\n\t\t\tself.mustPrint = true;\n\t\t\tself.nestLevel += 1;\n\t\t}\n\t\tlet printable = '<' + tag.name;\n\t\tif (self.opts.stripAttributes === false) {\n\t\t\tif (tag.attributes) {\n\t\t\t\tfor (const i in tag.attributes) {\n\t\t\t\t\tif (tag.attributes[i]) {\n\t\t\t\t\t\tprintable += ' ' + i + '=\"';\n\t\t\t\t\t\tprintable += entityQuotes(tag.attributes[i]) + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintable += (self.isSelfClosing) ? '/>' : '>';\n\t\tprint(printable);\n\t\tself.level += self.mustPrint ? 1 : 0;\n\t\tme.emit('opentag', tag);\n\t};\n\n\tparser.onclosetag = function (tag) {\n\t\tself.level -= self.mustPrint ? 1 : 0;\n\t\tif (!self.isSelfClosing) {\n\t\t\tprint('</' + tag + '>');\n\t\t}\n\t\tif (tag === self.tagFilter) {\n\t\t\tself.nestLevel -= 1;\n\t\t\tif (self.nestLevel === 0) {\n\t\t\t\tself.mustPrint = false;\n\t\t\t}\n\t\t}\n\t\tself.isSelfClosing = false;\n\t\tme.emit('closetag', tag);\n\t};\n\n\tparser.onattribute = function (attr) {\n\t\tme.emit('attribute', attr);\n\t};\n\n\tparser.ontext = function (text) {\n\t\tprint(text);\n\t\tme.emit('text', text);\n\t};\n\n\tparser.onopencdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint('<![CDATA[');\n\t\t\tme.emit('opencdata');\n\t\t}\n\t};\n\n\tparser.oncdata = function (text) {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tself.level += 1;\n\t\t\tprint(text);\n\t\t\tself.level -= 1;\n\t\t\tme.emit('cdata', text);\n\t\t}\n\t};\n\n\tparser.onclosecdata = function () {\n\t\tif (self.opts.stripCdata === false) {\n\t\t\tprint(']]>');\n\t\t\tme.emit('closecdata');\n\t\t}\n\t};\n\n\tparser.oncomment = function (comment) {\n\t\tif (self.opts.stripComments === false) {\n\t\t\tprint('<!-- ' + comment + ' -->');\n\t\t\tme.emit('comment', comment);\n\t\t}\n\t};\n\n\tparser.ondoctype = function (doctype) {\n\t\tif (self.opts.stripDoctype === false) {\n\t\t\tprint('<!DOCTYPE' + doctype + '>');\n\t\t\tme.emit('doctype', doctype);\n\t\t}\n\t};\n\n\tparser.onprocessinginstruction = function (instruction) {\n\t\tif (self.opts.stripInstruction === false) {\n\t\t\tprint('<?' + instruction.name + ' ' + instruction.body + '?>');\n\t\t\tme.emit('instruction', instruction);\n\t\t}\n\t};\n\n\tparser.write(lastChunk);\n\tlastChunk = '';\n\tcb();\n};\n\nconst endStream = function (cb) {\n\tlastChunk += decoder.end();\n\tif (lastChunk.length > 0) {\n\t\tparser.write(lastChunk);\n\t}\n\tcb();\n};\n\nexport default function (opts) {\n\tself.mustPrint = false;\n\tself.tagFilter = (opts && opts.tagFilter) ? opts.tagFilter : null;\n\tif (self.tagFilter === null) {\n\t\tself.mustPrint = true;\n\t}\n\tself.level = 0;\n\tself.nestLevel = 0;\n\tdeepAssign(self.opts, defaultOpts, opts ? opts : {});\n\n\treturn through(transformStream, endStream);\n}\n"],"names":["StringDecoder"],"mappings":"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"}